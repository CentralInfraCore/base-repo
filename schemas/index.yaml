---
# JSON Schema for a SchemaFile, written in YAML

type: object
required:
  - metadata
  - spec

properties:
  metadata:
    type: object
    description: |
      Common metadata block for all versioned components.
    properties:
      name:
        type: string
        description: "The name of the schema component."
      version:
        type: string
        description: |
          The version of the schema component (e.g., v1.0.0 or v1.0.dev).
        pattern: "^v(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*|dev)$"
      description:
        type: string
        description: "A brief description of the schema's purpose."
      owner:
        type: string
        description: "The team or entity responsible for maintaining this schema (e.g., platform-engineering)."
      tags:
        type: array
        description: "A list of tags for categorization and discovery."
        items:
          type: string
      createdBy:
        type: object
        description: |
          Identifies the entity responsible for the schema and provides
          the cryptographic proof of identity.
        properties:
          name:
            type: string
            description: |
              Human-readable name of the author (e.g., from the certificate's
              Common Name).
          email:
            type: string
            format: email
            description: |
              Contact email of the author (e.g., from the certificate's Subject
              Alternative Name).
          certificate:
            type: string
            description: |
              The full PEM-encoded certificate of the author. This is the
              primary proof of identity.
            pattern: |
              ^-----BEGIN CERTIFICATE-----(.|\\n|\\r)\
              +-----END CERTIFICATE-----.?$
          issuer_certificate:
            type: string
            description: |
              The full PEM-encoded certificate of the Issuing Authority (CA)
              that signed the author's certificate.
            pattern: |
              ^-----BEGIN CERTIFICATE-----(.|\\n|\\r)\
              +-----END CERTIFICATE-----.?$
        required:
          - name
          - email
          - certificate
          - issuer_certificate
      build_timestamp:
        type: string
        format: date-time
        description: |
          The exact timestamp when this version of the schema was
          built and signed.
      validity:
        type: object
        description: "Defines the support lifecycle for this schema version."
        properties:
          from:
            type: string
            format: date-time
            description: |
              The date from which this schema version is considered valid.
          until:
            type: string
            format: date-time
            description: |
              The date until which this schema version is supported.
              After this date, it should be considered deprecated.
        required:
          - from
          - until
      checksum:
        type: string
        description: |
          A checksum (e.g., SHA256) of the 'spec' block content for
          integrity checks.
      sign:
        type: string
        description: |
          A cryptographic signature of the metadata block  \
          (excluding 'checksum' and 'sign' fields).
    # Base requirements for all versions
    required:
      - name
      - version
      - description
      - owner
      - createdBy
    # Conditional requirements for non-dev versions
    allOf:
      - if:
          properties:
            version:
              not:
                pattern: "\\.dev$"
        then:
          required:
            - build_timestamp
            - validity
            - checksum
            - sign
  spec:
    type: object
    description: |
      The core schema definition itself, which should follow \
      the JSON Schema specification.
